# Migration `20201206140937-chat`

This migration has been generated by wabi91 at 12/6/2020, 11:09:37 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `Chat` (
    `id` VARCHAR(191) NOT NULL,
    `createAt` DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
    `updateAt` DATETIME(3) NOT NULL,

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `Message` (
    `id` VARCHAR(191) NOT NULL,
    `text` VARCHAR(191) NOT NULL,
    `chatId` VARCHAR(191) NOT NULL,
    `fromUserId` INT NOT NULL,
    `toUserId` INT NOT NULL,
    `createAt` DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
    `updateAt` DATETIME(3) NOT NULL,

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_chatParticipants` (
    `A` VARCHAR(191) NOT NULL,
    `B` INT NOT NULL,
UNIQUE INDEX `_chatParticipants_AB_unique`(`A`,
`B`),
INDEX `_chatParticipants_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `Message` ADD FOREIGN KEY (`chatId`) REFERENCES `Chat`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Message` ADD FOREIGN KEY (`fromUserId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Message` ADD FOREIGN KEY (`toUserId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_chatParticipants` ADD FOREIGN KEY (`A`) REFERENCES `Chat`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_chatParticipants` ADD FOREIGN KEY (`B`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201201133753-first-init..20201206140937-chat
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "mysql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -21,10 +21,13 @@
   bio       String
   posts     Post[]
   likes     Like[]
   comments  Comment[]
+  chats     Chat[] @relation("chatParticipants")
   followers User[] @relation("UserFollows", references: [id])
   following User[] @relation("UserFollows", references: [id])
+  inbox     Message[] @relation("MessageReceiver")
+  outbox    Message[] @relation("MessageSender")
   createAt  DateTime @default(now())
   updateAt  DateTime @updatedAt
 }
@@ -68,5 +71,26 @@
   post      Post @relation(fields: [postId], references: [id])
   postId    Int
   createAt  DateTime @default(now())
   updateAt  DateTime @updatedAt
+}
+
+model Chat {
+  id        String @id @default(cuid())
+  members   User[] @relation("chatParticipants", references: [id])
+  messages  Message[]
+  createAt  DateTime @default(now())
+  updateAt  DateTime @updatedAt
+}
+
+model Message {
+  id          String @id @default(cuid())
+  text        String
+  chat        Chat @relation(fields: [chatId], references: [id])
+  chatId      String
+  from        User @relation("MessageSender", fields: [fromUserId], references: [id])
+  fromUserId  Int
+  to          User @relation("MessageReceiver", fields: [toUserId], references: [id])
+  toUserId    Int
+  createAt    DateTime @default(now())
+  updateAt    DateTime @updatedAt
 }
```


